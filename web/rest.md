### Содержание
+ [REST-архитектура](#rest-архитектура)
+ [REST API и веб-сервисы](#rest-api-и-веб-сервисы)
+ [HTTP-методы](#http-методы)
+ [Коды состояния](#коды-состояния)
+ [Конечные точки API](#конечные-точки-api)
+ [REST и Python](#rest-и-python)
+ [Заключение](#заключение)

*[Источник](https://realpython.com/api-integration-in-python/)*

### REST-архитектура
REST означает передачу репрезентативного состояния и представляет собой стиль архитектуры программного обеспечения, который определяет шаблон для взаимодействия клиента и сервера по сети. REST предоставляет набор ограничений для архитектуры программного обеспечения для повышения производительности, масштабируемости, простоты и надежности системы.

REST определяет следующие архитектурные ограничения:

Без сохранения состояния: сервер не будет поддерживать какое-либо состояние между запросами от клиента.
Клиент-сервер: клиент и сервер должны быть отделены друг от друга, позволяя каждому развиваться независимо.
Кэшируемость: данные, полученные с сервера, должны кэшироваться либо клиентом, либо сервером.
Единый интерфейс: сервер предоставит единый интерфейс для доступа к ресурсам без определения их представления.
Многоуровневая система: клиент может обращаться к ресурсам на сервере косвенно через другие уровни, такие как прокси-сервер или балансировщик нагрузки.
Код по запросу (необязательно): сервер может передавать клиенту код, который он может запустить, например JavaScript для одностраничного приложения.
Обратите внимание, что REST — это не спецификация, а набор рекомендаций по архитектуре программной системы, подключенной к сети.

### REST API и веб-сервисы
Веб-служба REST — это любая веб-служба, которая придерживается ограничений архитектуры REST. Эти веб-службы предоставляют свои данные внешнему миру через API. API-интерфейсы REST обеспечивают доступ к данным веб-службы через общедоступные веб-URL-адреса.

Например, вот один из URL-адресов GitHub REST API:

https://api.github.com/users/<имя пользователя>
Этот URL-адрес позволяет получить доступ к информации о конкретном пользователе GitHub. Вы получаете доступ к данным из REST API, отправляя HTTP-запрос на определенный URL-адрес и обрабатывая ответ.


### HTTP-методы
API-интерфейсы REST прослушивают методы HTTP, такие как GET, POST и DELETE, чтобы узнать, какие операции выполнять с ресурсами веб-службы. Ресурс — это любые данные, доступные в веб-службе, к которым можно получить доступ и которыми можно управлять с помощью HTTP-запросов к REST API. Метод HTTP сообщает API, какое действие необходимо выполнить с ресурсом.

Хотя существует множество методов HTTP, перечисленные ниже пять методов наиболее часто используются с REST API:

|HTTP-метод  |Описание
|:----------:|:------------------------------------:|
|GET         |Получить существующий ресурс.|
|POST        |Создать новый ресурс.|
|PUT         |Обновить существующий ресурс.|
|PATCH       |Частично обновить существующий ресурс.|
|DELETE      |Удалить ресурс.|

Клиентское приложение REST API может использовать эти пять методов HTTP для управления состоянием ресурсов в веб-службе.


### Коды состояния
Как только REST API получает и обрабатывает HTTP-запрос, он возвращает HTTP-ответ. В этот ответ включен код состояния HTTP. Этот код предоставляет информацию о результатах запроса. Приложение, отправляющее запросы к API, может проверять код состояния и выполнять действия на основе результата. Эти действия могут включать обработку ошибок или отображение пользователю сообщения об успешном выполнении.

Ниже приведен список наиболее распространенных кодов состояния, возвращаемых REST API:

|Код   |Значение                  |Описание
|:----:|:------------------------:|:------------------------------------------------------------------------------------------------:|
|200   |OK                        |Запрошенное действие выполнено успешно.|
|201   |Created                   |Создан новый ресурс.|
|202   |Accepted                  |Запрос получен, но никаких изменений еще не внесено.|
|204   |No Content                |Запрос выполнен успешно, но ответ не имеет содержимого.|
|400   |Bad Request               |Запрос был неправильно сформирован.|
|401   |Unauthorized              |Клиент не авторизован для выполнения запрошенного действия.|
|404   |Not Found                 |Запрошенный ресурс не найден.|
|415   |Unsupported Media         |Type Формат данных запроса не поддерживается сервером.|
|422   |Unprocessable Entity      |Данные запроса были правильно отформатированы, но содержали недопустимые или отсутствующие данные.|
|500   |Internal Server Error     |Сервер выдал ошибку при обработке запроса.|


Эти десять кодов состояния представляют лишь небольшое подмножество доступных кодов состояния HTTP. Коды состояния нумеруются в зависимости от категории результата:

|Диапазон кодов      |Категория
|:------------------:|:---------------:|
|2хх                 |Успешная операция|
|3xx                 |Перенаправление|
|4xx                 |Ошибка клиента|
|5xx                 |Ошибка сервера|

Коды состояния HTTP пригодятся при работе с REST API, поскольку вам часто нужно выполнять другую логику на основе результатов запроса.


### Конечные точки API
REST API предоставляет набор общедоступных URL-адресов, которые клиентские приложения используют для доступа к ресурсам веб-службы. Эти URL-адреса в контексте API называются конечными точками.

Чтобы разобраться в этом, взгляните на таблицу ниже. В этой таблице вы увидите конечные точки API для гипотетической системы CRM. Эти конечные точки предназначены для ресурса клиента, который представляет потенциальных клиентов в системе:

|Конечная точка API метода   |HTTP                      |Описание
|:--------------------------:|:------------------------:|:------------------------:|
|GET                         |/customers                |Получить список клиентов.|
|GET                         |/customers/<customer_id>  |Получить одного клиента.|
|POST                        |/customers                |Создать нового клиента.|
|PUT                         |/customers/<customer_id>  |Обновить клиента.|
|PATCH                       |/customers/<customer_id>  |Частично обновить клиента.|
|DELETE                      |/customers/<customer_id>  |Удалить клиента.|

Каждая из вышеперечисленных конечных точек выполняет разные действия на основе метода HTTP.

Вы заметите, что некоторые конечные точки имеют <customer_id> в конце. Эта нотация означает, что вам нужно добавить числовой идентификатор customer_id к URL-адресу, чтобы сообщить REST API, с каким клиентом вы хотите работать.

Перечисленные выше конечные точки представляют только один ресурс в системе. Готовые к работе API-интерфейсы REST часто имеют десятки или даже сотни различных конечных точек для управления ресурсами в веб-службе.


### REST и Python
Чтобы написать код, взаимодействующий с REST API, большинство разработчиков Python обращаются к запросам на отправку HTTP-запросов. Эта библиотека абстрагируется от сложностей создания HTTP-запросов. Это один из немногих проектов, к которым стоит относиться как к части стандартной библиотеки.

Чтобы начать использовать запросы, вам нужно сначала установить его. Вы можете использовать pip для его установки:

$ python -m pip запросы на установку
Теперь, когда у вас установлены запросы, вы можете начать отправлять HTTP-запросы.

GET
GET — это один из наиболее распространенных методов HTTP, которые вы будете использовать при работе с REST API. Этот метод позволяет извлекать ресурсы из заданного API. GET — это операция только для чтения, поэтому ее не следует использовать для изменения существующего ресурса.

Чтобы протестировать GET и другие методы в этом разделе, вы будете использовать службу под названием JSONPlaceholder. Этот бесплатный сервис предоставляет поддельные конечные точки API, которые отправляют ответы, которые могут обрабатываться запросами.

Чтобы попробовать это, запустите Python REPL и выполните следующие команды, чтобы отправить запрос GET на конечную точку JSONPlaceholder:

```python
>>> импорт запросов
>>> api_url = "https://jsonplaceholder.typicode.com/todos/1"
>>> ответ = запросы.get(api_url)
>>> ответ.json()
{'userId': 1, 'id': 1, 'title': 'delectus aut autem', 'completed': False}
```

Этот код вызывает request.get() для отправки запроса GET в /todos/1, который отвечает элементом todo с идентификатором 1. Затем вы можете вызвать .json() для объекта ответа, чтобы просмотреть данные, которые вернулись из API.

Данные ответа отформатированы как JSON, хранилище ключей и значений, похожее на словарь Python. Это очень популярный формат данных и формат обмена де-факто для большинства REST API.

Помимо просмотра данных JSON из API, вы также можете просмотреть другие сведения об ответе:

```python
>>> response.status_code
200

>>> response.headers["Тип контента"]
'приложение/json; кодировка=utf-8'
```

Здесь вы получаете доступ к response.status_code, чтобы увидеть код состояния HTTP. Вы также можете просмотреть HTTP-заголовки ответа с помощью response.headers. Этот словарь содержит метаданные об ответе, такие как Content-Type ответа.

POST
Теперь взгляните на то, как вы используете запросы к данным POST в REST API для создания нового ресурса. Вы снова будете использовать JSONPlaceholder, но на этот раз вы включите данные JSON в запрос. Вот данные, которые вы будете отправлять:

```python
{
    "идентификатор пользователя": 1,
    "title": "Купить молоко",
    "завершено": ложь
}
```

Этот JSON содержит информацию о новом элементе списка дел. Вернувшись в Python REPL, запустите следующий код, чтобы создать новую задачу:

```python
>>> импорт запросов
>>> api_url = "https://jsonplaceholder.typicode.com/todos"
>>> todo = {"userId": 1, "title": "Купить молоко", "completed": False}
>>> ответ = запросы.post(api_url, json=todo)
>>> ответ.json()
{'userId': 1, 'title': 'Купить молоко', 'completed': False, 'id': 201}

>>> response.status_code
201
```
Здесь вы вызываете request.post(), чтобы создать новую задачу в системе.

Сначала вы создаете словарь, содержащий данные для вашей задачи. Затем вы передаете этот словарь аргументу ключевого слова json в request.post(). Когда вы делаете это, request.post() автоматически устанавливает Content-Type HTTP-заголовка запроса в application/json. Он также сериализует todo в строку JSON, которую добавляет к телу запроса.

Если вы не используете аргумент ключевого слова json для предоставления данных JSON, вам необходимо соответствующим образом установить Content-Type и сериализовать JSON вручную. Вот версия, эквивалентная предыдущему коду:

```python
>>> импорт запросов
>>> импортировать json
>>> api_url = "https://jsonplaceholder.typicode.com/todos"
>>> todo = {"userId": 1, "title": "Купить молоко", "completed": False}
>>> заголовки = {"Content-Type":"application/json"}
>>> response = request.post (api_url, data = json.dumps (todo), headers = headers)
>>> ответ.json()
{'userId': 1, 'title': 'Купить молоко', 'completed': False, 'id': 201}

>>> response.status_code
201
```
В этом коде вы добавляете словарь заголовков, который содержит один заголовок Content-Type со значением application/json. Это сообщает REST API, что вы отправляете данные JSON с запросом.

Затем вы вызываете request.post(), но вместо передачи todo аргументу json вы сначала вызываете json.dumps(todo) для его сериализации. После сериализации вы передаете его аргументу ключевого слова данных. Аргумент данных сообщает запросам, какие данные включать в запрос. Вы также передаете словарь заголовков в request.post(), чтобы установить заголовки HTTP вручную.

Когда вы вызываете request.post() таким образом, это имеет тот же эффект, что и предыдущий код, но дает вам больше контроля над запросом.

Примечание: json.dumps() происходит из пакета json в стандартной библиотеке. Этот пакет предоставляет полезные методы для работы с JSON в Python.

Как только API ответит, вы вызываете response.json() для просмотра JSON. JSON включает сгенерированный идентификатор для новой задачи. Код состояния 201 говорит вам, что был создан новый ресурс.

PUT
Помимо GET и POST, запросы обеспечивают поддержку всех других методов HTTP, которые вы могли бы использовать с REST API. Следующий код отправляет запрос PUT для обновления существующей задачи новыми данными. Любые данные, отправленные с запросом PUT, полностью заменят существующие значения задачи.

Вы будете использовать ту же конечную точку JSONPlaceholder, что и с GET и POST, но на этот раз вы добавите 10 в конец URL-адреса. Это сообщает REST API, какие задачи вы хотите обновить:

```python
>>> импорт запросов
>>> api_url = "https://jsonplaceholder.typicode.com/todos/10"
>>> ответ = запросы.get(api_url)
>>> ответ.json()
{'userId': 1, 'id': 10, 'title': 'это есть ... aut', 'completed': True}

>>> todo = {"userId": 1, "title": "Помыть машину", "completed": True}
>>> ответ = запросы.put(api_url, json=todo)
>>> ответ.json()
{'userId': 1, 'title': 'Помыть машину', 'completed': True, 'id': 10}


>>> response.status_code
200
```
Здесь вы сначала вызываете request.get() для просмотра содержимого существующей задачи. Затем вы вызываете request.put() с новыми данными JSON, чтобы заменить существующие значения списка дел. Вы можете увидеть новые значения при вызове response.json(). Успешные запросы PUT всегда будут возвращать 200 вместо 201, потому что вы не создаете новый ресурс, а просто обновляете существующий.

PATCH
Далее вы будете использовать request.patch() для изменения значения определенного поля в существующей задаче. PATCH отличается от PUT тем, что не заменяет полностью существующий ресурс. Он только изменяет значения, установленные в JSON, отправленном с запросом.

Вы будете использовать ту же самую задачу из последнего примера, чтобы попробовать request.patch(). Вот текущие значения:

```python
{'userId': 1, 'title': 'Помыть машину', 'completed': True, 'id': 10}
```
Теперь вы можете обновить заголовок новым значением:

```python
>>> импорт запросов
>>> api_url = "https://jsonplaceholder.typicode.com/todos/10"
>>> todo = {"title": "Скосить газон"}
>>> ответ = запросы.патч(api_url, json=todo)
>>> ответ.json()
{'userId': 1, 'id': 10, 'title': 'Скосить газон', 'completed': True}

>>> response.status_code
200
```
Когда вы вызываете response.json(), вы видите, что заголовок был обновлен до «Косить газон».


DELETE
И последнее, но не менее важное: если вы хотите полностью удалить ресурс, используйте DELETE. Вот код для удаления задачи:

```python
>>> импорт запросов
>>> api_url = "https://jsonplaceholder.typicode.com/todos/10"
>>> ответ = запросы.удалить(api_url)
>>> ответ.json()
{}

>>> response.status_code
200
```
Вы вызываете request.delete() с URL-адресом API, который содержит идентификатор задачи, которую вы хотите удалить. Это отправляет запрос DELETE в REST API, который затем удаляет соответствующий ресурс. После удаления ресурса API возвращает пустой объект JSON, указывающий, что ресурс был удален.

Библиотека запросов — отличный инструмент для работы с REST API и незаменимая часть вашего набора инструментов Python. В следующем разделе вы переключитесь на другую передачу и подумаете, что нужно для создания REST API.


### Заключение
REST API есть везде. Знание того, как использовать Python для использования и создания API, позволяет вам работать с огромным объемом данных, предоставляемых веб-сервисами.
